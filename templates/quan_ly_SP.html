<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Qu·∫£n L√Ω S·∫£n Ph·∫©m</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='quan_ly_SP.css') }}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="logo">üòé Admin</div>
      <nav>
        <ul>
          <li><a href="{{ url_for('bang_dieu_khien') }}">B·∫£ng ƒëi·ªÅu khi·ªÉn</a></li>
          <li class="active"><a href="{{ url_for('quan_ly_san_pham') }}">Qu·∫£n l√Ω s·∫£n ph·∫©m</a></li>
          <li><a href="{{ url_for('quan_ly_nguoi_dung') }}">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</a></li>
          <li><a href="{{ url_for('quan_ly_don_hang') }}">Qu·∫£n l√Ω ƒë∆°n h√†ng</a></li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <header class="top-bar">
        <input type="text" placeholder="T√¨m ki·∫øm">
        <div class="icons">
          <span>üîî</span>
          <span>üí¨</span>
          <span class="avatar">T√†i kho·∫£n</span>
        </div>
      </header>

      <section class="form-section">
        <h3>B·∫£ng qu·∫£n l√Ω s·∫£n ph·∫©m</h3>
        <!-- <div class="form-grid">
          <div class="input-group">
            <label for="ma_sp">M√£ s·∫£n ph·∫©m</label>
            <input type="text" id="ma_sp" placeholder="M√£ s·∫£n ph·∫©m" required>
          </div>
          <div class="input-group">
            <label for="gia_nhap">Gi√° nh·∫≠p</label>
            <input type="number" step="0.01" id="gia_nhap" placeholder="Gi√° nh·∫≠p">
          </div>
          <div class="input-group">
            <label for="so_luong">S·ªë l∆∞·ª£ng</label>
            <input type="number" id="so_luong" placeholder="S·ªë l∆∞·ª£ng">
          </div>
          <div class="input-group">
            <label for="ten_sp">T√™n s·∫£n ph·∫©m</label>
            <input type="text" id="ten_sp" placeholder="T√™n s·∫£n ph·∫©m" required>
          </div>
          <div class="input-group">
            <label for="gia_goc">Gi√° g·ªëc</label>
            <input type="number" step="0.01" id="gia_goc" placeholder="Gi√° g·ªëc">
          </div>
          <div class="input-group">
            <label for="the_loai">Th·ªÉ Lo·∫°i</label>
            <input type="text" id="the_loai" placeholder="Th·ªÉ Lo·∫°i">
          </div>
          <div class="input-group">
            <label for="tac_gia">T√°c gi·∫£</label>
            <input type="text" id="tac_gia" placeholder="T√°c gi·∫£">
          </div>
          <div class="input-group">
            <label for="gia_ban">Gi√° b√°n</label>
            <input type="number" step="0.01" id="gia_ban" placeholder="Gi√° b√°n">
          </div>
          <div class="input-group">
            <label for="mo_ta">M√¥ t·∫£ s·∫£n ph·∫©m</label>
            <textarea id="mo_ta" placeholder="M√¥ t·∫£ s·∫£n ph·∫©m"></textarea>
          </div>
          <div class="input-group">
            <label for="nam_xb">NƒÉm xu·∫•t b·∫£n</label>
            <input type="number" id="nam_xb" placeholder="NƒÉm xu·∫•t b·∫£n">
          </div>
          <div class="input-group">
            <label for="ngon_ngu">Ng√¥n Ng·ªØ</label>
            <input type="text" id="ngon_ngu" placeholder="Ng√¥n ng·ªØ">
          </div>
          <div class="input-group">
            <label for="hinh_anh">H√¨nh ·∫£nh</label>
            <input type="text" id="hinh_anh" placeholder="URL h√¨nh ·∫£nh">
          </div>
        </div> -->
        <div class="form-grid">
          <div class="input-group">
            <label for="ma_sp">M√£ s·∫£n ph·∫©m</label>
            <input type="text" id="ma_sp" placeholder="M√£ s·∫£n ph·∫©m">
          </div>
          <div class="input-group">
            <label for="gia_nhap">Gi√° nh·∫≠p</label>
            <input type="text" id="gia_nhap" placeholder="Gi√° nh·∫≠p">
          </div>
          <div class="input-group">
            <label for="so_luong">S·ªë l∆∞·ª£ng</label>
            <input type="text" id="so_luong" placeholder="S·ªë l∆∞·ª£ng">
          </div>
          <div class="input-group">
            <label for="ten_sp">T√™n s·∫£n ph·∫©m</label>
            <input type="text" id="ten_sp" placeholder="T√™n s·∫£n ph·∫©m">
          </div>
          <div class="input-group">
            <label for="gia_goc">Gi√° g·ªëc</label>
            <input type="text" id="gia_goc" placeholder="Gi√° g·ªëc">
          </div>
          <div class="input-group">
          <label for="the_loai">Th·ªÉ Lo·∫°i</label>
          <select id="the_loai" name="the_loai" class="input-group">
            {% for tl in theloais %}
              <option value="{{ tl.matheloai }}">{{ tl.tentheloai }}</option>
            {% endfor %}
          </select>
          </div>
          <div class="input-group">
            <label for="tac_gia">T√°c gi·∫£</label>
            <select id="tac_gia" name="tac_gia" class="input-group">
              {% for tg in tacgias %}
                <option value="{{ tg.matacgia }}">{{ tg.hovaten }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="input-group">
            <label for="gia_ban">Gi√° b√°n</label>
            <input type="text" id="gia_ban" placeholder="Gi√° b√°n">
          </div>
          <div class="input-group">
            <label for="mo_ta">M√¥ t·∫£ s·∫£n ph·∫©m</label>
            <input type="text" id="mo_ta" placeholder="M√¥ t·∫£ s·∫£n ph·∫©m">
          </div>
          <div class="input-group">
            <label for="nam_xb">NƒÉm xu·∫•t b·∫£n</label>
           <input type="number" id="nam_xb" name="namxuatban" min="1900" max="2100" />
          </div>
          <div class="input-group">
          <label for="ngon_ngu">Ng√¥n Ng·ªØ</label>
          <select id="ngon_ngu" name="ngon_ngu">
            <option value="Ti·∫øng Vi·ªát">Ti·∫øng Vi·ªát</option>
            <option value="Ti·∫øng n∆∞·ªõc ngo√†i">Ti·∫øng n∆∞·ªõc ngo√†i</option>
          </select>
        </div>
          <div class="input-group">
            <label for="hinh_anh">H√¨nh ·∫£nh</label>
            <input type="text" id="hinh_anh" placeholder="H√¨nh ·∫£nh">
          </div>
        </div>
        <div class="form-actions">
          <button class="btn-add">Th√™m</button>
          <button class="btn-edit">S·ª≠a</button>
          <button class="btn-delete">X√≥a</button>
        </div>
      </section>

      <section class="data-table">
        <h4>B·∫£ng d·ªØ li·ªáu:</h4>
        <table>
          <thead>
            <tr>
              <th>M√£ SP</th>
              <th>T√™n SP</th>
              <th>T√°c gi·∫£</th>
              <th>NƒÉm XB</th>
              <th>Gi√° nh·∫≠p</th>
              <th>Gi√° g·ªëc</th>
              <th>Gi√° b√°n</th>
              <th>S·ªë l∆∞·ª£ng</th>
              <th>Th·ªÉ lo·∫°i</th>
              <th>Ng√¥n ng·ªØ</th>
              <th>H√¨nh ·∫£nh</th>
              <th>M√¥ t·∫£</th>
            </tr>
          </thead>
          <tbody>
            {% for sp in sanphams %}
            <tr>
              <td class="green">{{ sp.masanpham }}</td>
              <td>{{ sp.tensanpham or '(NULL)' }}</td>
              <td class="blue">{{ sp.matacgia or '(NULL)' }}</td>
              <td>{{ sp.namxuatban or '(NULL)' }}</td>
              <td class="blue">{{ sp.gianhap | round(2) if sp.gianhap else '(NULL)' }}</td>
              <td class="blue">{{ sp.giagoc | round(2) if sp.giagoc else '(NULL)' }}</td>
              <td class="blue">{{ sp.giaban | round(2) if sp.giaban else '(NULL)' }}</td>
              <td class="blue">{{ sp.soluong | int if sp.soluong else '(NULL)' }}</td>
              <td class="blue">{{ sp.matheloai or '(NULL)' }}</td>
              <td class="green">{{ sp.ngonngu or '(NULL)' }}</td>
              <td><img src="{{ sp.hinhanh or '' }}" alt="H√¨nh ·∫£nh" class="product-img"></td>
              <td>{{ sp.mota or '(NULL)' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </section>
    </main>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    // $(document).ready(function() {
    //   $('.btn-add').click(function() {
    //     let data = {
    //       ma_sp: $('#ma_sp').val().trim(),
    //       ten_sp: $('#ten_sp').val().trim(),
    //       tac_gia: $('#tac_gia').val().trim() || null,
    //       nam_xb: $('#nam_xb').val() || null,
    //       gia_nhap: $('#gia_nhap').val() || null,
    //       gia_goc: $('#gia_goc').val() || null,
    //       gia_ban: $('#gia_ban').val() || null,
    //       so_luong: $('#so_luong').val() || null,
    //       the_loai: $('#the_loai').val().trim() || null,
    //       ngon_ngu: $('#ngon_ngu').val().trim() || null,
    //       hinh_anh: $('#hinh_anh').val().trim() || null,
    //       mo_ta: $('#mo_ta').val().trim() || null
    //     };

    //     if (!data.ma_sp) {
    //       alert('Vui l√≤ng nh·∫≠p m√£ s·∫£n ph·∫©m!');
    //       return;
    //     }
    //     if (!data.ten_sp) {
    //       alert('Vui l√≤ng nh·∫≠p t√™n s·∫£n ph·∫©m!');
    //       return;
    //     }

    //     $.ajax({
    //       url: '/api/sanpham',
    //       type: 'POST',
    //       contentType: 'application/json',
    //       data: JSON.stringify(data),
    //       success: function(response) {
    //         if (response.success) {
    //           alert(response.message);
    //           $('.form-grid input, .form-grid textarea').val('');
    //           location.reload();
    //         } else {
    //           alert('L·ªói: ' + response.error);
    //         }
    //       },
    //       error: function(xhr) {
    //         alert('L·ªói k·∫øt n·ªëi server: ' + xhr.statusText);
    //       }
    //     });
    //   });
    // });
     document.querySelector(".btn-add").addEventListener("click", function () {
      const data = {
        masanpham: document.getElementById("ma_sp").value,
        tensanpham: document.getElementById("ten_sp").value,
        matacgia: document.getElementById("tac_gia").value,
        namxuatban: document.getElementById("nam_xb").value,
        gianhap: document.getElementById("gia_nhap").value,
        giagoc: document.getElementById("gia_goc").value,
        giaban: document.getElementById("gia_ban").value,
        soluong: document.getElementById("so_luong").value,
        matheloai: document.getElementById("the_loai").value,
        ngonngu: document.getElementById("ngon_ngu").value,
        hinhanh: document.getElementById("hinh_anh").value,
        mota: document.getElementById("mo_ta").value,
      };

      fetch("/api/sanpham", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      })
      .then((res) => res.json())
      .then((res) => {
        if (res.message) {
          alert("‚úÖ " + res.message);
          location.reload(); // ho·∫∑c g·ªçi h√†m load l·∫°i b·∫£ng
        } else {
          alert("‚ùå Th√™m th·∫•t b·∫°i: " + res.error);
        }
      })
      .catch((err) => {
        console.error("L·ªói khi th√™m:", err);
      });
    });

  </script>
</body>
</html>