<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="/static/sidebars_admin.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="logo">üòé Admin</div>
      <nav>
        <ul>
          <li><a href="{{ url_for('bang_dieu_khien') }}">B·∫£ng ƒëi·ªÅu khi·ªÉn</a></li>
          <li><a href="{{ url_for('quan_ly_san_pham') }}">Qu·∫£n l√Ω s·∫£n ph·∫©m</a></li>
          <li><a href="{{ url_for('quan_ly_nguoi_dung') }}">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</a></li>
          <li class="active"><a href="{{ url_for('quan_ly_don_hang') }}">Qu·∫£n l√Ω ƒë∆°n h√†ng</a></li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <header class="top-bar">
        <div class="search-controls">
          <input type="text" placeholder="T√¨m ki·∫øm">
          <button>T√¨m ki·∫øm</button>
        </div>
        <div class="icons">
          <span><img src="/static/Icons/bell-fill.svg" alt="Th√¥ng b√°o" class="icon-img"></span>
          <span><img src="/static/Icons/chat-dots-fill.svg" alt="Tin nh·∫Øn" class="icon-img"></span>
          <span class="avatar">T√†i kho·∫£n</span>
        </div>
      </header>

      <section class="form-section">
      <div class="form-header ">
        <h2 class="magin_kc">B·∫£ng qu·∫£n l√Ω ƒë∆°n h√†ng</h2>
        <div class="filter-search magin_kc">
          <div class="filter-section ">
            <span>Th√™m ƒëi·ªÅu ki·ªán l·ªçc</span>
            <span class="filter-item1">K√™nh b√°n h√†ng l√† Web</span>
            <span class="filter-item1">Ph∆∞∆°ng th·ª©c thanh to√°n l√† Thanh to√°n khi giao h√†ng (COD)</span>
          </div>
          <div class="search-group">
            <input type="text" class="search-bar" id="searchInput" placeholder="T√¨m ki·∫øm theo m√£ ƒë∆°n h√†ng ho·∫∑c m√£ kh√°ch h√†ng"/>
            <div class="button-group">
              <button class="search-button" id="searchBtn">T√¨m</button>
              <button class="save-button">L∆∞u b·ªô l·ªçc</button>
            </div>
          </div>
        </div>
      </div>

        <div class="table-section">
          <table>
            <thead>
              <tr>
                <th>M√£ ƒë∆°n h√†ng</th>
                <th>M√£ kh√°ch h√†ng</th>
                <th>ƒê·ªãa ch·ªâ ng∆∞·ªùi mua</th>
                <th>ƒê·ªãa ch·ªâ ng∆∞·ªùi b√°n</th>
                <th>Tr·∫°ng th√°i</th>
                <th>Thanh To√°n</th>
                <th>Tr·∫°ng th√°i thanh to√°n</th>
                <th>Ti·ªÅn thanh to√°n</th>
                <th>Ti·ªÅn thi·∫øu</th>
                <th>Ng√†y ƒë·∫∑t h√†ng</th>
                <th>Ng√†y giao h√†ng</th>
              </tr>
            </thead>
            <tbody id="orderTableBody">
              <!-- D·ªØ li·ªáu ƒë∆∞·ª£c th√™m b·∫±ng JS -->
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <!-- ƒê·∫∑t script ·ªü cu·ªëi ƒë·ªÉ ƒë·∫£m b·∫£o DOM ƒë√£ load -->
  <script>
    const tbody = document.getElementById("orderTableBody");

    // Load t·∫•t c·∫£ ƒë∆°n h√†ng
    fetch('/api/orders')
      .then(response => response.json())
      .then(data => {
        tbody.innerHTML = "";
        data.forEach(order => {
          const row = `
            <tr>
              <td>${order.madonhang}</td>
              <td>${order.makhachhang}</td>
              <td>${order.diachinguoimua || ''}</td>
              <td>${order.diachinguoinhan || ''}</td>
              <td>${order.trangthai || ''}</td>
              <td>${order.thanhtoan || ''}</td>
              <td>${order.trangthaithanhtoan || ''}</td>
              <td>${order.tienthanhtoan || ''}</td>
              <td>${order.tienthieu || ''}</td>
              <td>${order.ngaydathang || ''}</td>
              <td>${order.ngaygiaohang || ''}</td>
            </tr>
          `;
          tbody.innerHTML += row;
        });
      })
      .catch(error => console.error("L·ªói khi t·∫£i ƒë∆°n h√†ng:", error));

    // X·ª≠ l√Ω t√¨m ki·∫øm
    document.getElementById("searchBtn").addEventListener("click", () => {
      const keyword = document.getElementById("searchInput").value.trim();

      fetch(`/api/orders?keyword=${encodeURIComponent(keyword)}`)
        .then(response => {
          if (!response.ok) {
            throw new Error("Server tr·∫£ v·ªÅ l·ªói: " + response.statusText);
          }
          return response.json();
        })
        .then(data => {
          tbody.innerHTML = "";

          if (data.length === 0) {
            tbody.innerHTML = `
              <tr>
                <td colspan="11" style="text-align:center;">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o ph√π h·ª£p.</td>
              </tr>
            `;
            return;
          }

          data.forEach(order => {
            const row = `
              <tr>
                <td>${order.madonhang}</td>
                <td>${order.makhachhang}</td>
                <td>${order.diachinguoimua || ''}</td>
                <td>${order.diachinguoinhan || ''}</td>
                <td>${order.trangthai || ''}</td>
                <td>${order.thanhtoan || ''}</td>
                <td>${order.trangthaithanhtoan || ''}</td>
                <td>${order.tienthanhtoan || ''}</td>
                <td>${order.tienthieu || ''}</td>
                <td>${order.ngaydathang || ''}</td>
                <td>${order.ngaygiaohang || ''}</td>
              </tr>
            `;
            tbody.innerHTML += row;
          });
        })
        .catch(error => {
          console.error("L·ªói khi t·∫£i ƒë∆°n h√†ng:", error);
          tbody.innerHTML = `
            <tr>
              <td colspan="11" style="text-align:center; color: red;">
                ƒê√£ x·∫£y ra l·ªói khi t·∫£i d·ªØ li·ªáu. Vui l√≤ng th·ª≠ l·∫°i sau.
              </td>
            </tr>
          `;
        });
    });
  </script>
</body>
</html>
