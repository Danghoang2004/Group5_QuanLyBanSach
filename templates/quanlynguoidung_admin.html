<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="/static/sidebars_admin.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <div class="logo">üòé Admin</div>
      <nav>
        <ul>
          <li><a href="{{ url_for('bang_dieu_khien') }}">B·∫£ng ƒëi·ªÅu khi·ªÉn</a></li>
          <li><a href="{{ url_for('quan_ly_san_pham') }}">Qu·∫£n l√Ω s·∫£n ph·∫©m</a></li>
          <li class="active"><a href="{{ url_for('quan_ly_nguoi_dung') }}">Qu·∫£n l√Ω ng∆∞·ªùi d√πng</a></li>
          <li><a href="{{ url_for('quan_ly_don_hang') }}">Qu·∫£n l√Ω ƒë∆°n h√†ng</a></li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <header class="top-bar">
        <input type="text" placeholder="T√¨m ki·∫øm">
        <div class="icons">
          <span>üîî</span>
          <span>üí¨</span>
          <span class="avatar">T√†i kho·∫£n</span>
        </div>
      </header>

      <section class="form-section">
        <h2>B·∫£ng qu·∫£n l√Ω ng∆∞·ªùi d√πng</h2>
        <form class="user-form">
          <div class="form-group">
            <input type="text" id="makhachhang" placeholder="M√£ kh√°ch h√†ng">
            <input type="text" id="gioitinh" placeholder="Gi·ªõi t√≠nh">
            <input type="text" id="sodienthoai" placeholder="S·ªë ƒëi·ªán tho·∫°i">
          </div>
          <div class="form-group">
            <input type="text" id="tendangnhap" placeholder="T√™n ƒëƒÉng nh·∫≠p">
            <input type="text" id="diachi" placeholder="ƒê·ªãa ch·ªâ">
            <input type="email" id="email" placeholder="Email">
          </div>
          <div class="form-group">
            <input type="password" id="matkhau" placeholder="M·∫≠t kh·∫©u">
            <input type="date" id="ngaysinh" placeholder="Ng√†y sinh">
            <input type="text" id="dangkinhanbangtin" placeholder="ƒêƒÉng k√Ω nh·∫≠n b·∫£n tin">
          </div>
          <div class="form-group">
            <input type="text" id="hoten" placeholder="H·ªç v√† t√™n">
            <input type="text" id="diachinhanhang" placeholder="ƒê·ªãa ch·ªâ nh·∫≠n h√†ng">
          </div>
          <div class="buttons">
            <button type="button_them" id="btnThem">Th√™m</button>
            <button type="button_sua" id="btnSua">S·ª≠a</button>
            <button type="button_xoa" id="btnXoa">X√≥a</button>
            <button type="button_load" id="btnLoad">Load</button>
          </div>
        </form>
      </section>

      <section class="table-section">
        <h2>B·∫£ng d·ªØ li·ªáu ng∆∞·ªùi d√πng</h2>
        <table>
          <thead>
            <tr>
              <th>H·ªç t√™n</th>
              <th>T√™n ƒëƒÉng nh·∫≠p</th>
              <th>Gi·ªõi t√≠nh</th>
              <th>Ng√†y sinh</th>
              <th>S·ªë ƒëi·ªán tho·∫°i</th>
              <th>Email</th>
            </tr>
          </thead>
          <tbody id="userTableBody"></tbody>
        </table>
      </section>
    </main>
  </div>

<script>
let selectedUserId = "";

    document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("btnLoad").addEventListener("click", loadUsers);
    document.getElementById("btnThem").addEventListener("click", addUser);
    document.getElementById("btnSua").addEventListener("click", updateUser);
    document.getElementById("btnXoa").addEventListener("click", deleteUser);
    loadUsers();
});

function getInputData() {
    return {
        tendangnhap: document.getElementById("tendangnhap").value,
        matkhau: document.getElementById("matkhau").value,
        hoten: document.getElementById("hoten").value,
        gioitinh: document.getElementById("gioitinh").value,
        diachi: document.getElementById("diachi").value,
        diachinhanhang: document.getElementById("diachinhanhang").value,
        sodienthoai: document.getElementById("sodienthoai").value,
        email: document.getElementById("email").value,
        ngaysinh: document.getElementById("ngaysinh").value,
        dangkinhanbangtin: document.getElementById("dangkinhanbangtin").value === "1"
    };
}

function loadUsers() {
    fetch("/api/users")
        .then(res => res.json())
        .then(data => {
            const tbody = document.getElementById("userTableBody");
            tbody.innerHTML = "";
            data.forEach(user => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${user.hoten}</td>
                    <td>${user.tendangnhap}</td>
                    <td>${user.gioitinh}</td>
                    <td>${user.ngaysinh}</td>
                    <td>${user.sodienthoai}</td>
                    <td>${user.email}</td>
                `;
                tr.addEventListener("click", () => {
                    selectedUserId = user.makhachhang;
                    for (let key in user) {
                        const el = document.getElementById(key);
                        if (el) el.value = user[key];
                    }
                });
                tbody.appendChild(tr);
            });
        });
}

function addUser() {
    const data = getInputData();
    if (!data.tendangnhap || !data.matkhau) {
        alert("Vui l√≤ng nh·∫≠p t√™n ƒëƒÉng nh·∫≠p v√† m·∫≠t kh·∫©u.");
        return;
    }
    fetch("/api/users", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    }).then(() => loadUsers());
}

function updateUser() {
    if (!selectedUserId) return alert("Vui l√≤ng ch·ªçn ng∆∞·ªùi d√πng ƒë·ªÉ s·ª≠a.");
    const data = getInputData();
    fetch(`/api/users/${selectedUserId}`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data)
    }).then(() => loadUsers());
}

function deleteUser() {
    if (!selectedUserId) return alert("Vui l√≤ng ch·ªçn ng∆∞·ªùi d√πng ƒë·ªÉ x√≥a.");
    fetch(`/api/users/${selectedUserId}`, {
        method: "DELETE"
    }).then(() => loadUsers());
}
</script>
</body>
</html>
